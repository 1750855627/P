[
	parsers.DSL = '"Parser at ..\Tools\PCompiler\DSLParser.dll"',
	modules.PData = '"PData at ..\Libraries\Formula\PData.4ml"',
	parse_ActiveParser = "DSL"
]


//////
// Description : Defer_2
// This example tests the defer set implementation along with priority 
// transitions and actions has higher priority over deferred set.
// Call statements and call edges are both tested
/////  
model Defer_2 of PData
{

   ///////////////////////////////////////////////
   ///////        Event Alphabet          ////////
   ///////////////////////////////////////////////
    eE1 is EventDecl("E1", AssertMaxInstances(1), NIL).
	eE2 is EventDecl("E2", AssertMaxInstances(1), NIL).
	eE3 is EventDecl("E3", AssertMaxInstances(1), NIL).
	eE4 is EventDecl("E4", AssertMaxInstances(1), NIL).
	eUnit is EventDecl("unit", AssertMaxInstances(1), NIL).

    /// Event Set
    es1Real is EventSetDecl("Es1", mReal).
    InEventSet(es1Real, eE2).
    InEventSet(es1Real, eE3).
   ///////////////////////////////////////////////
   ///////    Declartions of Machines     ////////
   ///////////////////////////////////////////////
     
   mReal is MachineDecl("Real", FALSE, NIL).
   MachStart(mReal, sReal_Init).

   mGhost is MachineDecl("Ghost", TRUE, NIL).
   MachStart(mGhost, sGhost_Init).

    ///////////////////////////////////////////////
   ///////         Var Declarations        ////////
   ///////////////////////////////////////////////
 
   VarDecl("ghost", mReal, ID, TRUE).    
   VarDecl("real", mGhost, ID, FALSE). 

   ///////////////////////////////////////////////
   ///////  Real States and Transitions   ////////
   ///////////////////////////////////////////////
     
   sReal_Init is StateDecl(     
       "Real_Init",
       mReal,
       `{
	       ghost = new Ghost(real = this);  
           raise(Events.unit);	   
       }`,
       es1Real).                   

   mReal_Action is ActionDecl("Action_1", mReal, `{send(ghost, Events.E1);} call (States.Real_S3);`). 
   Install(sReal_Init, eE4, mReal_Action). 

   sReal_S1 is StateDecl(
       "Real_S1",
	   mReal,
	   `{
          send (ghost, Events.E1);
	   }`,
	   NIL).


  sReal_S2 is StateDecl(
       "Real_S2",
	   mReal,
	   `{
	   }`,
	   NIL). 

   sReal_S3 is StateDecl(
        "Real_S3",
	    mReal,
	    `{
	    }`,
	    NIL). 

   mReal_Action_2 is ActionDecl("Action_2", mReal, `{assert(false);}`). 
   Install(sReal_S3, eE3, mReal_Action_2). 
    


   TransDecl(sReal_Init, eUnit, sReal_S1, TRUE).
   TransDecl(sReal_S1, eE3, sReal_S2, FALSE).
                
   ///////////////////////////////////////////////
   ///////  ghost States and Transitions   ////////
   ///////////////////////////////////////////////
     
   sGhost_Init is StateDecl(
       "Ghost_Init",
	   mGhost,
	   `{
	   }`,
	   NIL).

  sGhost_S1 is StateDecl(
      "Ghost_S1",
	  mGhost,
	  `{	
            send (real, Events.E2);
            send (real, Events.E3);
            send (real, Events.E4); 	  
	  }`,
	  NIL). 

 
   TransDecl(sGhost_Init, eE1, sGhost_S1, FALSE).
   TransDecl(sGhost_S1, eE1, sGhost_S1, FALSE).
   MainDecl(New(MachType("Real"), NIL)).
}
